/*!
 * Document Library Pro 1.6
 * Copyright 2022 Barn2 Plugins
 */
(()=>{"use strict";const e=window.lodash;jQuery((function(s){const a=function(){s(".dlp-category").on("click",this.handleFolderToggle),s(document).on("input keyup",'.dlp-folders-search input[type="search"]',(0,e.debounce)(this.handleFolderSearch,300)),s(document).on("click",".dlp-folders-reset",this.handleFolderSearchReset)};a.prototype.handleFolderToggle=function(e){const a=s(this),l=a.parents(".dlp-folder").first(),d=l.find(".dlp-category-table").first(),o=l.data("category-id"),t=a.parents(".dlp-folders-root").data("shortcode-atts");l.hasClass("closed")&&!l.hasClass("table-loaded")&&(d.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),s.ajax({url:dlp_folders_params.ajax_url,type:"POST",data:{category_id:o,shortcode_atts:t,action:dlp_folders_params.ajax_action,_ajax_nonce:dlp_folders_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){d.html(e.html),"table"===e.layout&&d.children("table").first().postsTable(),d.unblock(),s(document).trigger("dlp_folder_opened",l)})),l.addClass("table-loaded")),l.hasClass("closed")||l.find(".dlp-folder").each((function(e,a){const l=s(a);l.hasClass("closed")||l.addClass("closed")})),l.toggleClass("closed"),l.siblings(".dlp-folder").not(l).each((function(e,a){const l=s(a);l.hasClass("closed")||(l.addClass("closed"),l.find(".dlp-folder").each((function(e,a){const l=s(a);l.hasClass("closed")||l.addClass("closed")})))}))},a.prototype.handleFolderSearch=function(e){const a=s(this),l=a.parents(".dlp-folders-container").first(),d=l.find(".dlp-folders"),o=l.find(".dlp-folders-search-results"),t=l.find(".dlp-folders-reset"),r=l.find(".dlp-folders-root").data("shortcode-atts"),n=!!o.hasClass("search-loaded")&&o.find("> div").attr("id");console.log(n);const c=a.val();if(c.length<=3)return o.hide(),d.show(),void t.hide();t.show(),l.find('.dlp-folders-search input[type="search"]').not(this).each((function(e){s(this).val(a.val())})),l.block({message:null,overlayCSS:{background:"#fff",opacity:.7}}),s.ajax({url:dlp_folders_params.ajax_url,type:"POST",data:{library_id:n,search_query:c,shortcode_atts:r,action:dlp_folders_params.ajax_folder_search,_ajax_nonce:dlp_folders_params.ajax_nonce},xhrFields:{withCredentials:!0}}).done((function(e){d.hide(),o.show(),o.html(e.html),"table"===e.layout&&o.children("table").first().postsTable(),o.addClass("search-loaded"),l.unblock()}))},a.prototype.handleFolderSearchReset=function(e){e.preventDefault();const a=s(this).parents(".dlp-folders-container").first(),l=a.find(".dlp-folders"),d=a.find('.dlp-folders-search input[type="search"]'),o=a.find(".dlp-folders-reset"),t=a.find(".dlp-folders-search-results");d.each((function(e){s(this).val("")})),o.each((function(e){s(this).hide()})),l.show(),t.hide()},new a}))})();